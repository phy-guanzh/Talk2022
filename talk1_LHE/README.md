# LHE

LHE is acronym for ```The Les Houches Event file format``` in Monte Carlo event generators.<br />
Most of event generators provide a limited set of Matrix Element (ME) processes. they are able to generate additional hard emissions on Matrix Element level, that would otherwise have to be approximated by the Parton Shower in a less precise way. <br />

(typically the Parton Shower (PS) underestimates additional hard emissions and should preferrably be used only the soft and collinear case, whereas the (LO) Matrix Element calculations can describe those better taking into account all possible Feynman diagrams int the hard process). <br />

First, we will start from basic ME processes based on Madgraph5@NLO (MG5@NLO). It is an automatic code that for computing the cross-section and generating events for most of processes at colliders.<br />

In this scetion, we will focus on MG5@NLO in genproduction(). It is the MC generator reposity for CMS including many events generator and if you request official samples at CMS, this reposity is also necessary..

Assumed that we would like to generate $WW\gamma$ leptonic process.


## Install

```
git clone https://github.com/cms-sw/genproductions.git 
cd genproductions/bin/MadGraph5_aMCatNLO/
```

at MG5, in general, gridpack generated by MG5 is used to request offical samples as the first step.

and we will learn how to generate one gridpack first.

## Simplest Usage

example:

go through the details in the cards at genproductions/bin/MadGraph5_aMCatNLO/cards/examples/wplustest_4f_LO/.


```
./gridpack_generation.sh wplustest_4f_LO cards/examples/wplustest_4f_LO/

```

after you generated it, you can use it to produce LHE events.

``` 
cd wplustest_4f_LO/wplustest_4f_LO_gridpack/work/gridpack/
./runcmsgrid.sh 10 10 4  
```

then you can use random number 10 to generate 10 events.

go through the LHE events (cms_final.lhe) and combine with slides 2 to understand contents in the file.


Assumed that we would like to generate $WW\gamma$ leptonic process:
TASK1: find WWAToLNuLNuA_4f_NLO cards in genproduction and generate gridpack for process WWAToLNuLNuA_4f_NLO, then generate 20000 LHE events for WWAToLNuLNuA_4f_NLO.

trick: use ```nohup``` command to submit job (https://en.wikipedia.org/wiki/Nohup) or use condor at PKUFARM

```
./submit_condor_gridpack_generation.sh wplustest_4f_LO cards/examples/wplustest_4f_LO/

```

## analyse at LHE level. 


after we get LHE events, how to get information we want from LHE? 


```
c++ -o read_04 `root-config --glibs --cflags` CfgParser.cc LHEF.cc -lm read_04.cpp
```
and $you need to prepare one cfg file indicate the path/cross-sections of your samples$.

then, you can get one ROOT file including many TH1 histogram with different variables.


```
./read_04 wwa_final_4f.cfg
```

look at those varibles hist, and combined with read_04.cpp. Which cuts are added to select the events.


If you complete this step, you have almost finished one samples analysis at LHE and other processes are similar.


# generate the gridpack you want

## step1: Change process card

if you want to change to another process, you can directly change process card first:

```
generate X Y  > A B C 
```
the default mode is lowest order production.


## step2: Change the run card
generally, for different process, the definations of phase space are different. But you can refer to similar process in genproctions.

for example, if you want to change minimum pt for the charged leptons, you can directly

```
5  = ptl
```


## additional step: Change the model/parameters or add madspin card.
previous examples are under SM model. if your process are defined in other model, you need to find it by yourself and import it.
there are two links where include many model: 

if you want to change model, you can add extramodels card, and $do not forget to fix model name in process card$.

```
XXX.tar.gz
```
it will be depressed in proper path and you can find destinations in gridpack_generation.sh.

if you want to fix one parameter based on your needs at MG5, customize_cards can help:

for example,

```
set param_card MASS 1 0.00469
```

madspin is one module can decay particles because in some cases, you can not decay particles by process card directly. 

then you need to add madspin card.

one example in genproduction:
ggh_dalitzeffective_5f_LO

Until now, you can define process, generate events at hard process level and analyse them by yourself. 
if necessary, you can change the default model/paramters and correct correponding cards.



## HELP

about MG5@NLO, if you meet problems and need help, you can ask questions in Madgraph5_aMC@NLO launchpad: https://answers.launchpad.net/mg5amcnlo

