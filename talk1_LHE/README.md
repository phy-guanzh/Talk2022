# LHE

LHE is the acronym for ```The Les Houches Event file format``` in Monte Carlo event generators.<br />
Most event generators provide a limited set of Matrix Element (ME) processes. they can  generate additional hard emissions on Matrix Element level that would otherwise have to be approximated by the Parton Shower in a less precise way. <br />

(typically, the Parton Shower (PS) underestimates additional hard emissions and should preferably be used only the soft and collinear case, whereas the (LO) Matrix Element calculations can describe those better taking into account all possible Feynman diagrams int the hard process). <br />

First, we will start with basic ME processes based on Madgraph5@NLO (MG5@NLO). It is an automatic code for computing the cross-section and generating events for most of the processes at colliders.<br />

In this section, we will focus on MG5@NLO in [genproduction](https://github.com/cms-sw/genproductions/tree/dace43b7b79c6c7d01d80bb17b96db6d84326830). It is the MC generator repository for CMS, including many events generators and if you request official samples at CMS, this repository is also necessary..

Assume that we would like to generate $WW\gamma$ leptonic process.


## Install

```
git clone https://github.com/cms-sw/genproductions.git 
cd genproductions/bin/MadGraph5_aMCatNLO/
```

At MG5, in general, the gridpack generated by MG5 is used to request official samples as the first step.


and we will learn how to generate one gridpack first.

## Simplest Usage

example:

go through the details in the cards at genproductions/bin/MadGraph5_aMCatNLO/cards/examples/wplustest_4f_LO/.


```
./gridpack_generation.sh wplustest_4f_LO cards/examples/wplustest_4f_LO/

```

After you generate it, you can use it to produce LHE events.

``` 
cd wplustest_4f_LO/wplustest_4f_LO_gridpack/work/gridpack/
./runcmsgrid.sh 10 10 4  
```
Then you can use the random number 10 to generate ten events.

Please go through the LHE events (cms_final.lhe) and combine them with slides to understand the contents in the file.


Assumed that we would like to generate $WW\gamma$ leptonic process:
TASK1: find WWAToLNuLNuA_4f_NLO cards in genproduction and generate gridpack for process WWAToLNuLNuA_4f_NLO, then generate 20000 LHE events for WWAToLNuLNuA_4f_NLO.

trick: use ```nohup``` command to submit jobs (https://en.wikipedia.org/wiki/Nohup) or use condor at PKUFARM

```
./submit_condor_gridpack_generation.sh wplustest_4f_LO cards/examples/wplustest_4f_LO/

```

## Analyse at LHE level. 

After we get LHE events, how to get the information we want from LHE?


```
c++ -o read_04 `root-config --glibs --cflags` CfgParser.cc LHEF.cc -lm read_04.cpp
```
And $you need to prepare one cfg file indicate the path/cross-sections of your samples$.
Then, you can get one ROOT file, including many TH1 histograms with different variables.


```
./read_04 wwa_final_4f.cfg
```

Look at those variables hist, and combined with read_04.cpp. Which cuts are added to select the events?

If you complete this step, you have almost finished the analysis of one sample at LHE, and other processes are similar.


# generate the gridpack you want

## step1: Change process card

if you want to change to another process, you can directly change process card first:

```
generate X Y  > A B C 
```
The default mode at MG5 is the lowest order production.


## step2: Change the run card
For different processes, the definitions of phase space are different. But you can refer to a similar process in genproductions.

for example, if you want to change the minimum pt for the charged leptons, you can directly

```
5  = ptl
```


## additional step: Change the model/parameters or add a madspin card.
Previous examples are under the SM model. If your process is defined in other models, you need to find it yourself and import it.
There are two links that include many models: 

If you want to change the model, you can add an extra models card, and $do not forget to fix the model name in the process card$.
there are two links where include many model: 

if you want to change model, you can add extramodels card, and $do not forget to fix model name in process card$.

in XXX_extramodels.dat, add the model you need:
```
XXX.tar.gz
```

It will be depressed in the proper path, and you can find destinations in gridpack_generation.sh.

if you want to fix one parameter based on your needs at MG5, customize_cards can help:
for example,

```
set param_card MASS 1 0.00469
```
Madspin is one module that can decay particles because, in some cases, you can not decay particles by process card directly. 

Then you need to add madspin card.

one example in genproduction:
ggh_dalitzeffective_5f_LO

You can define the process, generate events at the hard-process level, and analyse them yourself. 
If necessary, you can change the default model/paramters and correct corresponding cards.



## HELP

about MG5@NLO, if you meet problems and need help, you can ask questions in Madgraph5_aMC@NLO launchpad: https://answers.launchpad.net/mg5amcnlo

